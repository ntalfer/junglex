defmodule Junglex.CLITest do
  use ExUnit.Case, async: false
  import ExUnit.CaptureIO
  
  test "missing params" do
    assert capture_io(fn -> Junglex.CLI.main([]) end) =~ "Usage"
  end
  
  test "help" do
    assert capture_io(fn -> Junglex.CLI.main(["--help"]) end) =~ "Usage"
  end
  
  test "nominal case" do
    jobs_file = Path.join([__DIR__, "technical-test-jobs-small.csv"])
    categories_file = Path.join([__DIR__, "technical-test-professions.csv"])

    expected = """
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
|             | Total | Admin | Business | Conseil | Créa | Divers | Marketing / Comm' | Retail | Tech |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
| Total       | 9     | 1     | 3        | 0       | 0    | 0      | 1                 | 2      | 2    |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
| Afrique     | 0     | 0     | 0        | 0       | 0    | 0      | 0                 | 0      | 0    |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
| Amérique    | 1     | 0     | 0        | 0       | 0    | 0      | 0                 | 1      | 0    |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
| Antarctique | 0     | 0     | 0        | 0       | 0    | 0      | 0                 | 0      | 0    |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
| Asie        | 0     | 0     | 0        | 0       | 0    | 0      | 0                 | 0      | 0    |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
| Europe      | 8     | 1     | 3        | 0       | 0    | 0      | 1                 | 1      | 2    |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
| Inconnu     | 0     | 0     | 0        | 0       | 0    | 0      | 0                 | 0      | 0    |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+
| Océanie     | 0     | 0     | 0        | 0       | 0    | 0      | 0                 | 0      | 0    |
+-------------+-------+-------+----------+---------+------+--------+-------------------+--------+------+

"""
    
    res = capture_io(fn -> Junglex.CLI.main(["--j", jobs_file, "--p", categories_file]) end)

    assert res == expected
  end

end